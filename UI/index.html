<!doctype html>
<html lang="en">

<head>
    <title>App</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="build.css" />
    <script src="elm.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
    <link rel="manifest" href="favicon_io/site.webmanifest">
</head>

<body>
    <noscript>
        You need to enable JavaScript to run this app.
    </noscript>
    <div id="elm-app"></div>
    <script>
        const APP_NAME = 'TECH-STACK'

        const node = document.querySelector('#elm-app')
        if (node) {
            // Get token from local storage
            const token_str = sessionStorage.getItem(`${APP_NAME}_token`)
            const token_json = JSON.parse(token_str)
            const app = Elm.Main.init({
                node: node,
                flags: { 'token': token_json }
            })

            app.ports.storeTokenData.subscribe(token => {
                sessionStorage.setItem(`${APP_NAME}_token`, JSON.stringify(token));
            })

            app.ports.logoutUser.subscribe(() => {
                console.log("Logging out user")
                sessionStorage.removeItem(`${APP_NAME}_token`);
            })
        }
    </script>
</body>

</html>